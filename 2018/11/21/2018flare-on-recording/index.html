<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>2018flare-on recording | giglf的盐缸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="http:&#x2F;&#x2F;flare-on.com 记录一下今年的flare-on，断断续续做了好久，最后12题中总共解出6题，后面的题就不够时间看了 再一次感受到自己是在太菜了，发现自己在逆向的时候很不善于用一些有用的工具，大部分时候是通过自己手动硬逆，事实上，逆向的目的是要搞懂程序在干些什么，不必去过于探究一些细节，而对于我数学、算法方面的硬伤，只需要抽时间去恶补理论基础就好了。但对于逆向技巧，flare">
<meta property="og:type" content="article">
<meta property="og:title" content="2018flare-on recording">
<meta property="og:url" content="http://giglf.github.io/2018/11/21/2018flare-on-recording/index.html">
<meta property="og:site_name" content="giglf的盐缸">
<meta property="og:description" content="http:&#x2F;&#x2F;flare-on.com 记录一下今年的flare-on，断断续续做了好久，最后12题中总共解出6题，后面的题就不够时间看了 再一次感受到自己是在太菜了，发现自己在逆向的时候很不善于用一些有用的工具，大部分时候是通过自己手动硬逆，事实上，逆向的目的是要搞懂程序在干些什么，不必去过于探究一些细节，而对于我数学、算法方面的硬伤，只需要抽时间去恶补理论基础就好了。但对于逆向技巧，flare">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://giglf.github.io/2018/11/21/2018flare-on-recording/lief.png">
<meta property="og:image" content="http://giglf.github.io/2018/11/21/2018flare-on-recording/c4_getflag.png">
<meta property="og:image" content="http://giglf.github.io/2018/11/21/2018flare-on-recording/wow64.png">
<meta property="og:image" content="http://giglf.github.io/2018/11/21/2018flare-on-recording/c8_qemu.png">
<meta property="article:published_time" content="2018-11-21T02:52:25.000Z">
<meta property="article:modified_time" content="2019-04-11T09:46:03.499Z">
<meta property="article:author" content="giglf">
<meta property="article:tag" content="逆向">
<meta property="article:tag" content="flare-on">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://giglf.github.io/2018/11/21/2018flare-on-recording/lief.png">
  
    <link rel="alternative" href="/atom.xml" title="giglf的盐缸" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.jpg">
  
  
      
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
<meta name="generator" content="Hexo 5.4.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate"></a></h1>
        </hgroup>

        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">首页</a></li>
                        
                            <li><a href="/archives">文章</a></li>
                        
                            <li><a href="/tags">标签</a></li>
                        
                            <li><a href="/about">about</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="mailto:lin.giglf@gmail.com" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/giglf" title="github">github</a>
                            
                                <a class="fl rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Android/" style="font-size: 16px;">Android</a> <a href="/tags/Forensics/" style="font-size: 10px;">Forensics</a> <a href="/tags/Makefile/" style="font-size: 10px;">Makefile</a> <a href="/tags/Misc/" style="font-size: 10px;">Misc</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/apache2/" style="font-size: 10px;">apache2</a> <a href="/tags/flare-on/" style="font-size: 14px;">flare-on</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/mi3-td/" style="font-size: 10px;">mi3_td</a> <a href="/tags/mini-lctf/" style="font-size: 10px;">mini-lctf</a> <a href="/tags/minilctf/" style="font-size: 10px;">minilctf</a> <a href="/tags/nasm/" style="font-size: 10px;">nasm</a> <a href="/tags/network-manager/" style="font-size: 10px;">network-manager</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/pwn/" style="font-size: 10px;">pwn</a> <a href="/tags/pwnable-kr/" style="font-size: 10px;">pwnable.kr</a> <a href="/tags/pwnhub/" style="font-size: 10px;">pwnhub</a> <a href="/tags/reverse/" style="font-size: 12px;">reverse</a> <a href="/tags/scheme-v1/" style="font-size: 10px;">scheme v1</a> <a href="/tags/scheme-v2/" style="font-size: 10px;">scheme v2</a> <a href="/tags/so%E5%8A%A0%E8%BD%BD/" style="font-size: 10px;">so加载</a> <a href="/tags/unicode/" style="font-size: 10px;">unicode</a> <a href="/tags/utf-8/" style="font-size: 10px;">utf-8</a> <a href="/tags/writeup/" style="font-size: 10px;">writeup</a> <a href="/tags/%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/" style="font-size: 12px;">全国大学生信息安全竞赛初赛</a> <a href="/tags/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91/" style="font-size: 10px;">内核编译</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 10px;">密码学</a> <a href="/tags/%E6%B1%87%E7%BC%96/" style="font-size: 10px;">汇编</a> <a href="/tags/%E7%AD%BE%E5%90%8D%E8%AE%A4%E8%AF%81/" style="font-size: 12px;">签名认证</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size: 10px;">编码</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 20px;">逆向</a> <a href="/tags/%E9%9A%8F%E4%BE%BF%E5%86%99%E5%86%99%E5%95%A6/" style="font-size: 18px;">随便写写啦</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/luuman/hexo-theme-spfk">spfk主题</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">我都不知道我是谁了，大概只是一条只想吃吃喝喝的咸鱼吧</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">首页</a></li>
                
                    <li><a href="/archives">文章</a></li>
                
                    <li><a href="/tags">标签</a></li>
                
                    <li><a href="/about">about</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="mailto:lin.giglf@gmail.com" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/giglf" title="github">github</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-2018flare-on-recording" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/21/2018flare-on-recording/" class="article-date">
      <time datetime="2018-11-21T02:52:25.000Z" itemprop="datePublished">2018-11-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      2018flare-on recording
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/WriteUp/">WriteUp</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flare-on/" rel="tag">flare-on</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%80%86%E5%90%91/" rel="tag">逆向</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><a target="_blank" rel="noopener" href="http://flare-on.com">http://flare-on.com</a></p>
<p>记录一下今年的flare-on，断断续续做了好久，最后12题中总共解出6题，后面的题就不够时间看了</p>
<p>再一次感受到自己是在太菜了，发现自己在逆向的时候很不善于用一些有用的工具，大部分时候是通过自己手动硬逆，事实上，逆向的目的是要搞懂程序在干些什么，不必去过于探究一些细节，而对于我数学、算法方面的硬伤，只需要抽时间去恶补理论基础就好了。但对于逆向技巧，flareon给了一个很好的学习逆向的题目。</p>
<p>另外，flare-on的官方writeup真的是太感人了，太详细了！</p>
<p><a target="_blank" rel="noopener" href="https://www.fireeye.com/blog/threat-research/2018/10/2018-flare-on-challenge-solutions.html">https://www.fireeye.com/blog/threat-research/2018/10/2018-flare-on-challenge-solutions.html</a></p>
<p>希望明年能拿到徽章</p>
<span id="more"></span>
<hr>
<h2 id="Challenge-1"><a href="#Challenge-1" class="headerlink" title="Challenge 1"></a>Challenge 1</h2><p>一个java逆向，简单的通过jd-gui逆掉</p>
<h2 id="Challenge-2"><a href="#Challenge-2" class="headerlink" title="Challenge 2"></a>Challenge 2</h2><p>.net的逆向，一个扫雷的游戏，总共有897个雷，只有3个没雷的格子。</p>
<p>简单逆一下能发现这3个没雷的格子是初始化时硬编码的，所以确定了几个位置以后，直接点开3个格，就能getflag（数的我眼睛花</p>
<h2 id="Challenge-3"><a href="#Challenge-3" class="headerlink" title="Challenge 3"></a>Challenge 3</h2><p>这关包含48个PE文件，diff了一下发现只有部分数据不一样，每个文件的逻辑都是一样的，需要输入一个password，程序会创建一个jpg和显示一个字符。</p>
<p>这个jpg图像是一个lego拼接过程，左上角包含顺序数字。</p>
<p>48个文件，我开始想法是通过<code>pywin32</code>的进行模拟程序，把每一个处理自动化抽取出来，并且似乎最后要通过图像识别去提取图片中的数字。可惜这一部分我不会写，最后是通过手动的方式一个个抽取出来的（非常蠢的方法</p>
<hr>
<p>看回官方wp，resource是以一定格式储存的，所以其实是可以对每个binary进行提取处理。</p>
<p>这里有一个小技巧，就是通过python的vstruct.VStruct进行数据结构的构造</p>
<table>
<thead>
<tr>
<th>Offset</th>
<th>Description</th>
<th>(Decoded) value for 1BpnGjHOT7h5vvZsV4vISSb60Xj3pX5G.exe</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0</td>
<td>Password</td>
<td>ZImIT7DyCMOeF6</td>
</tr>
<tr>
<td>0x20</td>
<td>Filename</td>
<td>(XOR encoded) 65141174.png</td>
</tr>
<tr>
<td>0x30</td>
<td>Letter</td>
<td>(XOR encoded) w</td>
</tr>
<tr>
<td>0x4A</td>
<td>Return value</td>
<td>7</td>
</tr>
<tr>
<td>0x4C</td>
<td>Length RC4 encrypted data</td>
<td>0x47ED</td>
</tr>
<tr>
<td>0x50</td>
<td>RC4 encrypted data</td>
<td>&lt; PNG image data &gt;</td>
</tr>
</tbody>
</table>
<p>Table 2: Recovered resource data values for 1BpnGjHOT7h5vvZsV4vISSb60Xj3pX5G.exe </p>
<p>自己用了这么蠢的方法，大概是因为懒没有把binary逆清楚吧。。</p>
<hr>
<p>其他大佬解法</p>
<p><a target="_blank" rel="noopener" href="https://bruce30262.github.io/flare-on-challenge-2018-write-up/">https://bruce30262.github.io/flare-on-challenge-2018-write-up/</a></p>
<p>在一个ak了的dalao提到，他用到了LIEF这个工具</p>
<p>说实话，这个工具一直躺在我的GitHub star中。。我没有去看过他能干什么</p>
<p>lief能用来对一个二进制文件进行解析，在这题中，就能用其提取resource</p>
<p><img src="/2018/11/21/2018flare-on-recording/lief.png" alt="lief"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lief</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_code</span>(<span class="params">filename</span>):</span></span><br><span class="line">    binary = lief.parse(filename)</span><br><span class="line">    brick = binary.resources.childs.<span class="built_in">next</span>()</span><br><span class="line">    id_101 = brick.childs.<span class="built_in">next</span>()</span><br><span class="line">    data = id_101.childs.<span class="built_in">next</span>().content</span><br><span class="line"></span><br><span class="line">    code = <span class="string">&quot;&quot;</span></span><br><span class="line">    has_zero = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> has_zero == <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                has_zero = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            has_zero = <span class="literal">False</span></span><br><span class="line">            code += <span class="built_in">chr</span>(d)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(filename, code))</span><br></pre></td></tr></table></figure>
<h2 id="Challenge-4"><a href="#Challenge-4" class="headerlink" title="Challenge 4"></a>Challenge 4</h2><p>challenge 4是一道非常有意思的题目，这是一个js代码注入木马</p>
<p>首先，这道题目给了一个binstall.exe，是<code>.net</code>程序，通过dnspy反编译能看到做了混淆，而这个混淆也很好去，查了一下往年的flareon也有类似的<code>.net</code>混淆的题目，通过<code>de4dot</code>便能解混淆，这只是符号混淆</p>
<p>简单逆向一下，能看到几个关键信息</p>
<p>首先，这个安装器向目录<code>%APPDATA%\Microsoft\Internet Explorer\browserassist.dll</code>释放了一个dll，然后，向注册表的<code>AppInit_DLLs</code>字段写入这个dll，这个字段的作用是当进程启动时，会加载该dll</p>
<p>这里可参考<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/dlls/secure-boot-and-appinit-dlls">https://docs.microsoft.com/en-us/windows/desktop/dlls/secure-boot-and-appinit-dlls</a></p>
<blockquote>
<p>Only a small set of modern legitimate applications use this mechanism to load DLLs, while a large set of malware use this mechanism to compromise systems. … therefore usage of AppInit_DLLs is not recommended.</p>
</blockquote>
<p>正常情况下应用很少会用到该字段去加载dll，大部分需要用到该字段的都是恶意软件</p>
<p>在安装完这个dll后， binstall.exe便运行完毕，接下来需要逆向这个释放出来的dll</p>
<hr>
<p>对于这个dll，我刚开始是硬逆的，后来找到import表，从import表中找到网络相关的函数，找到了http请求到一些东西</p>
<p>这里其实还有一个技巧，在官方wp中提到，我们可以通过在ida中<code>View -&gt; Open subviews -&gt;Signatures</code>添加<code>vc32_14</code>和<code>vc32ucrt</code>使得我们不用去逆一些库函数</p>
<p>当时有twitter提到了只有在firefox上这个dll才能正常运行，我也没有细想去为什么，现在看回官方wp，才发现在逆向dll时忽略了很多函数</p>
<p>首先，从DllEntryPoint中可以根据常规套路找到DLLMain-&gt;0x100027D0</p>
<p>在DllMain中，做了获取当前加载该dll的进程名，并把进程名传进了两个函数，当校验成功便调用CreateThread</p>
<p>函数<code>sub_10002660</code>是一个简单的hash，并且进程名hash值要等于0x4932B10F，作者说到这是病毒常见的套路，用以隐藏进程名。这个hash正是firefox.exe对应的hash，而后一个函数则是检查firefox的版本要低于55。PS：这个hash不可逆，所以我们只能通过猜测，因为已知这应该是一个浏览器进程，所以在常见的浏览器中挨个试。</p>
<p>在随后的函数中，加入了一些字符串混淆，简单的通过放在栈上的byte异或进行字符串的恢复。</p>
<p>我用的方法比较蠢，把这些byte给dump出来，再通过手工的方法写代码进行异或处理，出题人给出了一个ida的python脚本，通过unicorn进行程序模拟执行，在print出字符串</p>
<p>恢复一堆后，发现设置user-agent的还有一堆base64编码的</p>
<p>base64解码后发现是乱码，看了下上下文，发现base64解码后还要通过一串rc4的解密，最后恢复出来是一个网址 <code>pastebin.com/raw/hvaru8NU</code></p>
<p>get请求这个数据，然后发现是一个json文件，包含了一些inject code什么的</p>
<p>接下来我就没有继续逆dll了，因为json中有一个host显示flare-on.com，并且也标明了几个js文件名，猜测是javascript代码注入，下了个老版的firefox，成功执行后访问flare-on，F12查看请求，请求中正是包含了那几个js文件，看了看的确包含进了注入的代码</p>
<p>分析注入代码，不难发现他往flare-on.com这个仿shell的网页中加入了一个<code>su</code>命令，并且前端验证密码，简单地逆出密码后取得root权限，再继续看注入的代码，发现获取root权限后可以cd到一个key目录，cd进去后ls一下就拿到flag了</p>
<p><img src="/2018/11/21/2018flare-on-recording/c4_getflag.png" alt="c4_getflag"></p>
<hr>
<p>其他启示</p>
<p>在dalao的wp中提到了一个工具<a target="_blank" rel="noopener" href="https://github.com/hasherezade/dll_to_exe">dll_to_exe</a></p>
<p>能把dll转为exe，通过对dll的一些修改，使得能够直接运行进行调试</p>
<h2 id="Challenge-5"><a href="#Challenge-5" class="headerlink" title="Challenge 5"></a>Challenge 5</h2><p>wasm逆向</p>
<p>index.html会加载main.js，main.js再加载test.wasm</p>
<p>简单逆向main.js可以看到，向test.wasm里的函数传入一串bytecode，并与输入的q参数进行Match函数处理，最后返回值为1则输入的flag对。</p>
<p>在刚开始，我通过chrome debugger去debug wasm，但是量比较大，并且wasm储存变量的方式比较特殊，我花了很长时间都没有理解这是在进行什么运算。</p>
<p>后来我就想着去找些处理工具了，但是我找了类似 <a target="_blank" rel="noopener" href="https://github.com/wwwg/wasmdec">https://github.com/wwwg/wasmdec</a> and <a target="_blank" rel="noopener" href="https://github.com/WebAssembly/wabt之类的，也没有能简化阅读的">https://github.com/WebAssembly/wabt之类的，也没有能简化阅读的</a></p>
<p>后来发现jeb能处理wasm，联想到曾经在Android上jeb的强大，便下了个试用版体验</p>
<p>果然。。极其给力，一会儿便分析出来了</p>
<p>从main.js的输入是bytecode，整个wasm是一个简单的字节处理的虚拟机，对输入做加减乘除异或等操作，一个简单的python脚本便能解决</p>
<hr>
<p>但是官方wp不应该是通过这种方式做的，再来看回官方wp</p>
<p>官方wp有一种方法，先通过wasm2c转换成c的源码，再用O3编译，最后用现成的工具进行反编译分析，我试了一下。。最后出来的东西超庞大。。比较混乱</p>
<p>也提到了一个在线的ide<a target="_blank" rel="noopener" href="https://webassembly.studio/，能以渲染过的wat格式进行展示，并且提到一个特性，在调试过程其可以触发Firefox的SpiderMonkey">https://webassembly.studio/，能以渲染过的wat格式进行展示，并且提到一个特性，在调试过程其可以触发Firefox的SpiderMonkey</a> JIT compiler，使得我们可以查看wasm在CPU上是怎么运行的，当转化成为熟悉的x86语言后，能更容易去进行理解。</p>
<p>再另外，就是IDA的wasm插件了<a target="_blank" rel="noopener" href="https://github.com/fireeye/idawasm">https://github.com/fireeye/idawasm</a></p>
<p>这个插件正是fireeye做的，与普通反编译出来好处是能以ida的方式看清程序架构，并且变量名也经过处理</p>
<p>然后就是一步步逆了，还可以通过wasm_emu.py在ida中进行模拟运行</p>
<p>我使用jeb算是偷鸡了，正确操作应该熟悉wasm的架构，指令，并通过自己去进行指令简化，也可以自己写一个parser进行解析</p>
<p>懒了懒了</p>
<h2 id="Challenge-6"><a href="#Challenge-6" class="headerlink" title="Challenge 6"></a>Challenge 6</h2><p>这题就纯粹是一个常规的逆向题了</p>
<p>一共666轮验证，666轮的输入与binary中的data进行异或，最后出来flag</p>
<p>首先，当中有一个很大的结构体数组，该数组里包含smc代码，输入的字节需要传进去作为函数的参数，经过check函数的判断再以确定其中一轮是否正确。</p>
<p>一轮结束后，会通过一个固定种子的rand进行数组打乱，重新生成smc数据，并重新写到binary中，然后然后再一次运行单轮check</p>
<p>我的解法是编写了每一个check函数的求解，通过程序模拟的方式进行666轮求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> util</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;magic&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">binary = f.read()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUInt</span>(<span class="params">offset</span>):</span></span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&#x27;&lt;I&#x27;</span>, binary[offset:offset+<span class="number">4</span>])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUInt64</span>(<span class="params">offset</span>):</span></span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&#x27;&lt;Q&#x27;</span>, binary[offset:offset+<span class="number">8</span>])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFuncStruct</span>(<span class="params">i</span>):</span></span><br><span class="line">    func = getUInt64(<span class="number">0x5100</span>+<span class="number">0x120</span>*i)</span><br><span class="line">    func_off = func - <span class="number">0x400000</span></span><br><span class="line">    func_len = getUInt(<span class="number">0x5100</span>+<span class="number">0x120</span>*i+<span class="number">8</span>)</span><br><span class="line">    key_start = getUInt(<span class="number">0x5100</span>+<span class="number">0x120</span>*i+<span class="number">12</span>)</span><br><span class="line">    key_len = getUInt(<span class="number">0x5100</span>+<span class="number">0x120</span>*i+<span class="number">16</span>)</span><br><span class="line">    cpy_dst = getUInt(<span class="number">0x5100</span>+<span class="number">0x120</span>*i+<span class="number">20</span>)</span><br><span class="line">    data = getUInt64(<span class="number">0x5100</span>+<span class="number">0x120</span>*i+<span class="number">24</span>)</span><br><span class="line">    data_off = data - <span class="number">0x600000</span></span><br><span class="line">    data_need = binary[<span class="number">0x5100</span>+<span class="number">0x120</span>*i+<span class="number">32</span>:<span class="number">0x5100</span>+<span class="number">0x120</span>*(i+<span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;func_off&#x27;</span>:func_off, <span class="string">&#x27;func_len&#x27;</span>:func_len, <span class="string">&#x27;key_start&#x27;</span>:key_start, <span class="string">&#x27;key_len&#x27;</span>:key_len, <span class="string">&#x27;cpy_dst&#x27;</span>:cpy_dst, <span class="string">&#x27;data_off&#x27;</span>:data_off, <span class="string">&#x27;data_need&#x27;</span>:data_need&#125;</span><br><span class="line"></span><br><span class="line">funcList = [getFuncStruct(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>)]</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0</span>] * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_fibnacci</span>(<span class="params">index</span>):</span></span><br><span class="line">    key_start, key_len, data_need = funcList[index][<span class="string">&#x27;key_start&#x27;</span>], funcList[index][<span class="string">&#x27;key_len&#x27;</span>], funcList[index][<span class="string">&#x27;data_need&#x27;</span>]</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_len):</span><br><span class="line">        num = struct.unpack(<span class="string">&#x27;&lt;Q&#x27;</span>, data_need[<span class="number">8</span>*i:<span class="number">8</span>*(i+<span class="number">1</span>)])[<span class="number">0</span>]</span><br><span class="line">        key[key_start+i] = util.findFibnacci(num)</span><br><span class="line">        result += <span class="built_in">chr</span>(key[key_start+i])</span><br><span class="line">    <span class="comment"># print &#x27;solve fibnacci:&#x27; + str(index) + &#x27;\t&#x27; + result</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_crc32</span>(<span class="params">index</span>):</span></span><br><span class="line">    key_start, key_len, data_need = funcList[index][<span class="string">&#x27;key_start&#x27;</span>], funcList[index][<span class="string">&#x27;key_len&#x27;</span>], funcList[index][<span class="string">&#x27;data_need&#x27;</span>]</span><br><span class="line">    data_need = struct.unpack(<span class="string">&#x27;&lt;I&#x27;</span>, data_need[:<span class="number">4</span>])[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> key_len == <span class="number">1</span>:</span><br><span class="line">        c = util.breakCrc32_len1(data_need)</span><br><span class="line">        key[key_start] = <span class="built_in">ord</span>(c)</span><br><span class="line">    <span class="keyword">elif</span> key_len == <span class="number">2</span>:</span><br><span class="line">        c = util.breakCrc32_len2(data_need)</span><br><span class="line">        key[key_start], key[key_start+<span class="number">1</span>] = <span class="built_in">ord</span>(c[<span class="number">0</span>]), <span class="built_in">ord</span>(c[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">elif</span> key_len == <span class="number">3</span>:</span><br><span class="line">        c = util.breakCrc32_len3(data_need)</span><br><span class="line">        key[key_start], key[key_start+<span class="number">1</span>], key[key_start+<span class="number">2</span>] = <span class="built_in">ord</span>(c[<span class="number">0</span>]), <span class="built_in">ord</span>(c[<span class="number">1</span>]), <span class="built_in">ord</span>(c[<span class="number">2</span>])</span><br><span class="line">    <span class="comment"># print &#x27;solve crc32:&#x27; + str(index) + &#x27;\t&#x27; + c</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_xor2A</span>(<span class="params">index</span>):</span></span><br><span class="line">    key_start, key_len, data_need = funcList[index][<span class="string">&#x27;key_start&#x27;</span>], funcList[index][<span class="string">&#x27;key_len&#x27;</span>], funcList[index][<span class="string">&#x27;data_need&#x27;</span>]</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_len):</span><br><span class="line">        key[key_start+i] = <span class="number">0x2A</span> ^ <span class="built_in">ord</span>(data_need[i])</span><br><span class="line">        result += <span class="built_in">chr</span>(key[key_start+i])</span><br><span class="line">    <span class="comment"># print &#x27;solve xor2A:&#x27; + str(index) + &#x27;\t&#x27; + result</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_xorWithStr</span>(<span class="params">index</span>):</span></span><br><span class="line">    key_start, key_len, data_need = funcList[index][<span class="string">&#x27;key_start&#x27;</span>], funcList[index][<span class="string">&#x27;key_len&#x27;</span>], funcList[index][<span class="string">&#x27;data_need&#x27;</span>]</span><br><span class="line">    v4 = <span class="built_in">map</span>(<span class="built_in">ord</span>, <span class="string">&#x27;Tis but a scratch.&#x27;</span>)</span><br><span class="line">    v10 = <span class="number">0</span></span><br><span class="line">    arr = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>):</span><br><span class="line">        v10 = (v10 + arr[i] + v4[i % <span class="number">18</span>]) &amp; <span class="number">0xff</span></span><br><span class="line">        arr[i], arr[v10] = arr[v10], arr[i]</span><br><span class="line">    v8 = <span class="number">0</span></span><br><span class="line">    v9 = <span class="number">0</span></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_len):</span><br><span class="line">        v9 = (v9 + <span class="number">1</span>) &amp; <span class="number">0xff</span></span><br><span class="line">        v8 = (v8 + arr[v9]) &amp; <span class="number">0xff</span></span><br><span class="line">        arr[v8], arr[v9] = arr[v9], arr[v8]</span><br><span class="line">        v10 = (arr[v9] + arr[v8]) &amp; <span class="number">0xff</span></span><br><span class="line">        key[key_start+i] = <span class="built_in">ord</span>(data_need[i]) ^ arr[v10]</span><br><span class="line">        result += <span class="built_in">chr</span>(key[key_start+i])</span><br><span class="line">    <span class="comment"># print &#x27;solve xorWithStr:&#x27; + str(index) + &#x27;\t&#x27; + result</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_strangeBase64</span>(<span class="params">index</span>):</span></span><br><span class="line">    key_start, key_len, data_need = funcList[index][<span class="string">&#x27;key_start&#x27;</span>], funcList[index][<span class="string">&#x27;key_len&#x27;</span>], funcList[index][<span class="string">&#x27;data_need&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span>(key_len % <span class="number">3</span> !=<span class="number">0</span>):</span><br><span class="line">        read_size = (key_len/<span class="number">3</span>+<span class="number">1</span>)*<span class="number">4</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        read_size = (key_len/<span class="number">3</span>)*<span class="number">4</span></span><br><span class="line">    table = <span class="string">&#x27;\x2A\x39\x5F\x64\xC2\xA7\x46\x23\x53\x6B\x74\x47\x28\x4D\x70\x42\x49\x25\x52\x6A\x62\x38\x40\x4A\x69\x45\x44\x59\x2D\x31\x24\x50\x67\x79\x54\x21\x4C\x76\x71\x66\x2B\x63\x68\x6D\x51\x57\x4F\x30\x65\x4E\x5A\x34\x75\x6E\x33\x6C\x37\x48\x26\x32\x77\x61\x7A\x4B&#x27;</span></span><br><span class="line">    ori_table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">    tran = string.maketrans(table, ori_table)</span><br><span class="line">    data_need = data_need[:read_size]</span><br><span class="line">    data_need = data_need.translate(tran)</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(read_size):</span><br><span class="line">        <span class="keyword">if</span> data_need[i] == <span class="string">&#x27;\x00&#x27;</span>:</span><br><span class="line">            res += <span class="string">&#x27;=&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res += data_need[i]</span><br><span class="line">    res = base64.b64decode(res)</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_len):</span><br><span class="line">        key[key_start + i] = <span class="built_in">ord</span>(res[i])</span><br><span class="line">        result += <span class="built_in">chr</span>(key[key_start+i])</span><br><span class="line">    <span class="comment"># print &#x27;solve strangeBase64:&#x27; + str(index) + &#x27;\t&#x27; + result</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_add13</span>(<span class="params">index</span>):</span></span><br><span class="line">    key_start, key_len, data_need = funcList[index][<span class="string">&#x27;key_start&#x27;</span>], funcList[index][<span class="string">&#x27;key_len&#x27;</span>], funcList[index][<span class="string">&#x27;data_need&#x27;</span>]</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_len):</span><br><span class="line">        key[key_start+i] = <span class="built_in">ord</span>(data_need[i]) - <span class="number">13</span></span><br><span class="line">        result += <span class="built_in">chr</span>(key[key_start+i])</span><br><span class="line">    <span class="comment"># print &#x27;solve add13:&#x27; + str(index) + &#x27;\t&#x27; + result</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_equal</span>(<span class="params">index</span>):</span></span><br><span class="line">    key_start, key_len, data_need = funcList[index][<span class="string">&#x27;key_start&#x27;</span>], funcList[index][<span class="string">&#x27;key_len&#x27;</span>], funcList[index][<span class="string">&#x27;data_need&#x27;</span>]</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_len):</span><br><span class="line">        key[key_start + i] = <span class="built_in">ord</span>(data_need[i]) </span><br><span class="line">        result += <span class="built_in">chr</span>(key[key_start+i])</span><br><span class="line">    <span class="comment"># print &#x27;solve equal:&#x27; + str(index) + &#x27;\t&#x27; + result</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findFunction</span>(<span class="params">code</span>):</span></span><br><span class="line">    <span class="keyword">if</span> code[:<span class="number">27</span>] == <span class="string">&#x27;UH\x89\xE5H\x89&#125;\xB8\x89u\xB4H\x89U\xA8\xC7E\xFC\x00\x00\x00\x00\xE9\x19\x01\x00\x00&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;fibnacci&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> code[:<span class="number">35</span>] == <span class="string">&#x27;UH\x89\xE5H\x89&#125;\xD8\x89u\xD4H\x89U\xC8\xC6E\xF3\x00\xC7E\xFC\x00\x00\x00\x00\xC7E\xF4\xFF\xFF\xFF\xFF\xEBR&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;crc32&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> code[:<span class="number">41</span>] == <span class="string">&#x27;UH\x89\xE5H\x81\xEC\xD0\x00\x00\x00H\x89\xBD\xC8\xFE\xFF\xFF\x89\xB5\xC4\xFE\xFF\xFFH\x89\x95\xB8\xFE\xFF\xFFH\xB8Tis but &#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;xorWithStr&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> code[:<span class="number">25</span>] == <span class="string">&#x27;UH\x89\xE5H\x89&#125;\xA8\x89u\xA4H\x89U\x98H\xB8*9_d\xC2\xA7F#&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;base64&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> code[:<span class="number">31</span>] == <span class="string">&#x27;UH\x89\xE5H\x89&#125;\xE8\x89u\xE4H\x89U\xD8\xC7E\xFC\x00\x00\x00\x00\xC7E\xFC\x00\x00\x00\x00\xEBa&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;add13&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> code[:<span class="number">24</span>] == <span class="string">&#x27;UH\x89\xE5H\x89&#125;\xE8\x89u\xE4H\x89U\xD8\xC7E\xFC\x00\x00\x00\x00\xEBU&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;equal&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> code[:<span class="number">24</span>] == <span class="string">&#x27;UH\x89\xE5H\x89&#125;\xE8\x89u\xE4H\x89U\xD8\xC7E\xFC\x00\x00\x00\x00\xEB]&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;xor2A&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">smc_core</span>(<span class="params">arr1, arr2, length</span>):</span></span><br><span class="line">    rel = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        rel += <span class="built_in">chr</span>(<span class="built_in">ord</span>(arr1[i]) ^ <span class="built_in">ord</span>(arr2[i]))</span><br><span class="line">    <span class="keyword">return</span> rel</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_once_round</span>():</span></span><br><span class="line">    <span class="keyword">global</span> funcList</span><br><span class="line">    <span class="keyword">global</span> key</span><br><span class="line">    <span class="comment"># funcList = [getFuncStruct(i) for i in range(33)]</span></span><br><span class="line">    key = [<span class="number">0</span>]*<span class="number">100</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(funcList)):</span><br><span class="line">        func = funcList[i]</span><br><span class="line">        result = smc_core(binary[func[<span class="string">&#x27;func_off&#x27;</span>]:], binary[func[<span class="string">&#x27;data_off&#x27;</span>]:], func[<span class="string">&#x27;func_len&#x27;</span>])</span><br><span class="line">        func_name = findFunction(result)</span><br><span class="line">        <span class="keyword">if</span> func_name == <span class="string">&#x27;fibnacci&#x27;</span>:</span><br><span class="line">            solve_fibnacci(i)</span><br><span class="line">        <span class="keyword">elif</span> func_name == <span class="string">&#x27;crc32&#x27;</span>:</span><br><span class="line">            solve_crc32(i)</span><br><span class="line">        <span class="keyword">elif</span> func_name == <span class="string">&#x27;xorWithStr&#x27;</span>:</span><br><span class="line">            solve_xorWithStr(i)</span><br><span class="line">        <span class="keyword">elif</span> func_name == <span class="string">&#x27;base64&#x27;</span>:</span><br><span class="line">            solve_strangeBase64(i)</span><br><span class="line">        <span class="keyword">elif</span> func_name == <span class="string">&#x27;add13&#x27;</span>:</span><br><span class="line">            solve_add13(i)</span><br><span class="line">        <span class="keyword">elif</span> func_name == <span class="string">&#x27;equal&#x27;</span>:</span><br><span class="line">            solve_equal(i)</span><br><span class="line">        <span class="keyword">elif</span> func_name == <span class="string">&#x27;xor2A&#x27;</span>:</span><br><span class="line">            solve_xor2A(i)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, key))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rand_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">replaceInBinary</span>(<span class="params">off, buf, length</span>):</span></span><br><span class="line">    <span class="keyword">global</span> binary</span><br><span class="line">    binary = binary[:off] + buf + binary[off+length:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">changeTable</span>():</span></span><br><span class="line">    <span class="keyword">global</span> rand_index</span><br><span class="line">    binFuncOffs = <span class="number">0xbc6</span></span><br><span class="line">    new_func_src = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    key_index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x21</span>):</span><br><span class="line">        v3 = i + util.random_num[rand_index] % (<span class="number">33</span>-i)</span><br><span class="line">        rand_index += <span class="number">1</span></span><br><span class="line">        func = funcList[v3]</span><br><span class="line">        </span><br><span class="line">        src = smc_core(binary[func[<span class="string">&#x27;func_off&#x27;</span>]:], binary[func[<span class="string">&#x27;data_off&#x27;</span>]:], func[<span class="string">&#x27;func_len&#x27;</span>])</span><br><span class="line">        func[<span class="string">&#x27;data_off&#x27;</span>] = (util.random_num[rand_index] % (<span class="number">0x10002</span> - func[<span class="string">&#x27;func_len&#x27;</span>]) + <span class="number">0x7620</span>)</span><br><span class="line">        rand_index += <span class="number">1</span></span><br><span class="line">        changeFunc = smc_core(src, binary[func[<span class="string">&#x27;data_off&#x27;</span>]:], func[<span class="string">&#x27;func_len&#x27;</span>])</span><br><span class="line">        new_func_src += changeFunc</span><br><span class="line">        </span><br><span class="line">        func[<span class="string">&#x27;func_off&#x27;</span>] = binFuncOffs</span><br><span class="line">        binFuncOffs += func[<span class="string">&#x27;func_len&#x27;</span>]</span><br><span class="line">        func[<span class="string">&#x27;key_start&#x27;</span>] = key_index</span><br><span class="line">        key_index += func[<span class="string">&#x27;key_len&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        funcList[v3], funcList[i] = funcList[i], funcList[v3]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x21</span>):</span><br><span class="line">        v4 = util.random_num[rand_index]</span><br><span class="line">        v4 = j + v4 % (<span class="number">33</span> - j)</span><br><span class="line">        rand_index += <span class="number">1</span></span><br><span class="line">        funcList[v4], funcList[j] = funcList[j], funcList[v4]</span><br><span class="line"></span><br><span class="line">    replaceInBinary(<span class="number">0xbc6</span>, new_func_src, <span class="built_in">len</span>(new_func_src))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">u64toS</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, num)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    flag = u64toS(<span class="number">0x45123A7920755C24</span>) + u64toS(<span class="number">0x17263719711D201E</span>) + u64toS(<span class="number">0x4A7C67303E100367</span>) + u64toS(<span class="number">0x11621308555E1B11</span>) + u64toS(<span class="number">0x122C17445A7C6C68</span>) + u64toS(<span class="number">0x576D0C6324095979</span>) + u64toS(<span class="number">0x265D0F6A0C27651F</span>) + u64toS(<span class="number">0xA375C1433594643</span>) + u64toS(<span class="number">0x2C16022663</span>)</span><br><span class="line">    flag = <span class="built_in">map</span>(<span class="built_in">ord</span>, <span class="built_in">list</span>(flag))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">666</span>):</span><br><span class="line">        once_key = solve_once_round()</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;[+]: Solve round &#123;&#125;, key: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i, once_key)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">            flag[j] ^= <span class="built_in">ord</span>(once_key[j])</span><br><span class="line">        changeTable()</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, flag))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line">    <span class="comment"># print solve_once_round()</span></span><br><span class="line">    <span class="comment"># changeTable()</span></span><br><span class="line">    <span class="comment"># print solve_once_round()</span></span><br></pre></td></tr></table></figure>
<p>本来计划用pwntools进行循环交互的，那么我就不需要去模拟数组打乱部分了，但是pwntools不知道什么原因会阻塞。我觉得我这种解法太复杂了，需要把整个binary逆一遍并且再模拟一遍，工作量很大，能否使用现有的工具去简化整个流程呢？</p>
<p>接下来看一看官方wp</p>
<hr>
<p>….看完了官方wp，居然是用gdb脚本爆破的，，，晕</p>
<h2 id="Challenge-7"><a href="#Challenge-7" class="headerlink" title="Challenge 7"></a>Challenge 7</h2><p>这是flare-on的第七题了，这道题当时简单看了一下没做出来，现在就着官方wp看一下</p>
<p>首先，刚开始的时候我看到了那个带flare-on字符串的函数，有个异或对比的操作，但是解出来是Th1s_1s_th3_wr0ng_k3y_</p>
<p>然后准备动态调看看什么情况，但是一跑就退出了，不知道什么情况，现在结合wp看，我是没有注意到关键的函数</p>
<p>很容易能注意到<code>sub_1001800</code>和<code>sub_1001600</code>这两个条件函数，只有满足才会执行接下来的流程</p>
<p>简单查了MS的api可知道，这是对系统的版本做了检查</p>
<p><code>sub_1001800</code>：只有Windows 7和Windows Server 2008 R2才能满足条件</p>
<p><code>sub_1001600</code>：通过PEB获取模块信息，对模块名进行hash，与hash值比较，程序要运行在WOW64的环境下</p>
<p>这里设计到WOW64（Windows on Windows ），这个机制是为了确保向前兼容，使得32位的程序能够直接运行在64位的系统上</p>
<p><img src="/2018/11/21/2018flare-on-recording/wow64.png" alt="wow64"></p>
<p>借用一下官方wp的图，原始32位windows跟借助wow所加载的dll是不一样的</p>
<p>程序还包含了一个x64call的函数，用了一种很hacker的技巧从32位跳转到执行64位程序</p>
<p><a target="_blank" rel="noopener" href="http://rce.co/knockin-on-heavens-gate-dynamic-processor-mode-switching/">http://rce.co/knockin-on-heavens-gate-dynamic-processor-mode-switching/</a></p>
<p>在分析中可以看到他把data里的数据都跟0xDEEDEEB异或，简单异或出来后就是一个64位的dll</p>
<p>通过一个导出的函数<code>X64Call</code>进行调用</p>
<p>X64Call中调用参数包含了一个偏移<code>0x580</code>，这个函数将会调用64bit dll中偏移为0x580的那个导出函数</p>
<hr>
<p>进入到64bit的dll，那个导出函数很值得注意，里面包含了一些<code>NtQueryInformationProcess</code>字符串，感觉像是在解释这些api的地址</p>
<p>这个先不管，注意到底下sub_180003100，第二个参数数据的开头是<code>MZ</code>，这又打包了一个dll，这个函数做了些qmemcpy的操作，看着挺复杂的，但是细看一下应该是根据PE文件头去读出整个PE文件，然后进行memcpy的操作</p>
<p>把这个crackme.dll文件dump出来，这又变成一个32位的dll了，继续分析。</p>
<p>32位dll中会接收localhost发送过来的信息，端口由用户输入，总共有29个循环</p>
<p>从64bit dll中会找到通过windows 的ioctl进行的socket connect等代码，从一个大的switch case中就能找到相关的异或代码，异或出来就是flag</p>
<hr>
<p>因为整个64bit dll分析起来非常复杂，整个binary通过一种很魔幻的方式去达成他的目的，真的是厉害</p>
<p>但是这题真实想做出其实不难，虽然接受的是再次内嵌的一个32位的dll，但是在64位中看到那么一块针对已有data进行异或的地方的时候，会下意思先尝试，这么一尝试就能拿到flag了，甚至都不需要再继续细逆。</p>
<p>但是这个函数埋藏得比较深，另外还带有许多配置操作的函数，导致这题的难度增加了不少。</p>
<h2 id="Challenge-8"><a href="#Challenge-8" class="headerlink" title="Challenge 8"></a>Challenge 8</h2><p>继续看下一题，file得出是一个DOS/MBR 的boot sector</p>
<p>我们可以直接用qemu启动，启动出来是一个非常DOS的界面，蓝屏白字，要求逆向输入password</p>
<p>一股古老的气息扑面而来 That’s funny!</p>
<p><img src="/2018/11/21/2018flare-on-recording/c8_qemu.png" alt="qemu"></p>
<p>接下来可以用qemu+GDB调试</p>
<p><code>qemu-system-x86_64 doogie.bin -S -s</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> .gdbinit</span></span><br><span class="line">set $lastcs = -1</span><br><span class="line"></span><br><span class="line">define hook-stop</span><br><span class="line"><span class="meta">  #</span><span class="bash"> There doesn<span class="string">&#x27;t seem to be a good way to detect if we&#x27;</span>re <span class="keyword">in</span> 16- or</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> 32-bit mode, but we always run with CS == 8 <span class="keyword">in</span> 32-bit mode.</span></span><br><span class="line">  if $cs == 8 || $cs == 27</span><br><span class="line">    if $lastcs != 8 &amp;&amp; $lastcs != 27</span><br><span class="line">      set architecture i386</span><br><span class="line">    end</span><br><span class="line">    x/i $pc</span><br><span class="line">  else</span><br><span class="line">    if $lastcs == -1 || $lastcs == 8 || $lastcs == 27</span><br><span class="line">      set architecture i8086</span><br><span class="line">    end</span><br><span class="line">    # Translate the segment:offset into a physical address</span><br><span class="line">    printf &quot;[%4x:%4x] &quot;, $cs, $eip</span><br><span class="line">    x/i $cs*16+$eip</span><br><span class="line">  end</span><br><span class="line">  set $lastcs = $cs</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>这里有个技巧，因为gef等插件不能显示实地址上的调试信息，所以我们可以通过这个脚本令单步调试的时候显示出bootloader上的指令</p>
<p><code>gdb -x .gdbinit doogie.bin</code> </p>
<p><code>b *0x7c00</code></p>
<p><code>target remote 127.0.0.1:1234</code></p>
<p>对于ROM，默认加载地址是在0x7c00，这是BIOS中的约定，具体为什么可以看</p>
<p><a target="_blank" rel="noopener" href="https://www.glamenv-septzen.net/en/view/6">Why BIOS loads MBR into 0x7C00 in x86</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">seg000:0027 sub_27          proc near               ; CODE XREF: seg000:0021↑p</span><br><span class="line">seg000:0027                 xor     eax, eax</span><br><span class="line">seg000:002A                 mov     di, sp</span><br><span class="line">seg000:002C                 push    eax</span><br><span class="line">seg000:002E                 push    ebx</span><br><span class="line">seg000:0030                 push    es</span><br><span class="line">seg000:0031                 push    8000h</span><br><span class="line">seg000:0034                 push    7</span><br><span class="line">seg000:0036                 push    10h</span><br><span class="line">seg000:0038                 mov     si, sp</span><br><span class="line">seg000:003A                 mov     dl, ds:7C45h</span><br><span class="line">seg000:003E                 mov     ah, 42h ; &#39;B&#39;</span><br><span class="line">seg000:0040                 int     13h             ; DISK - IBM&#x2F;MS Extension - EXTENDED READ (DL - drive, DS:SI - disk address packet)</span><br><span class="line">seg000:0042                 mov     sp, di</span><br><span class="line">seg000:0044                 retn</span><br><span class="line">seg000:0044 sub_27          endp</span><br></pre></td></tr></table></figure>
<p>那么，关键便是sub_27函数中的<code>int 13h</code>了</p>
<p>引用wiki中的解释</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/INT_13H#INT_13h_AH=42h:_Extended_Read_Sectors_From_Drive">https://en.wikipedia.org/wiki/INT_13H#INT_13h_AH=42h:_Extended_Read_Sectors_From_Drive</a></p>
<p>那么，在这里便是</p>
<table>
<thead>
<tr>
<th style="text-align:center">DAP Element</th>
<th style="text-align:center">Hex Byte</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Size</td>
<td style="text-align:center">10</td>
</tr>
<tr>
<td style="text-align:center">Reserved</td>
<td style="text-align:center">00</td>
</tr>
<tr>
<td style="text-align:center"># Sectors to Read</td>
<td style="text-align:center">00 07</td>
</tr>
<tr>
<td style="text-align:center">Destination Address</td>
<td style="text-align:center">00 00 80 00</td>
</tr>
<tr>
<td style="text-align:center">Start Sector</td>
<td style="text-align:center">00 00 00 00 00 00 00 01</td>
</tr>
</tbody>
</table>
<p>这整个中断的操作就是从第一扇区（sector）开始读取7个扇区放到0x8000上</p>
<p>而一个扇区的大小为0x200，即512 Bytes，所以我们不看一开始的loader，只需要把整个image rebase到0x8000-0x200 = 0x7E00即可对后续进行分析</p>
<p>或者可以把image偏移从0x200开始的数据dump出来，然后rebase到0x8000进行分析</p>
<p>然后则是分析程序逻辑，逻辑非常简单，把binary中固定的data与当前日期异或再与用户输入的密码异或</p>
<p>首先日期从开头文字已经提示了，是<code>1990/02/06</code><br>然后对用户输入的密码，首先明确几个限制，必须再0x20-0x7f这个可见字符集中，另外储存密码的buffer总长度为21</p>
<p>因为用于异或的data很大，那么这不可能是输出@flare-on之类的flag，猜测这是个asciiart</p>
<p>既然是asciiart，则输出应当也是可见字符，接下来便是通过暴力的方法进行解了</p>
<p>这实际上便是密码学中的一个问题，参考cryptopals上的一道题目</p>
<p><a target="_blank" rel="noopener" href="http://cryptopals.com/sets/1/challenges/6">http://cryptopals.com/sets/1/challenges/6</a></p>
<p>通过计算等长的字符串的汉明距离（hamming distance），距离最小的便是猜测密码的可能长度</p>
<p>然后便可以对密码进行进一步的猜测</p>
<p>官方wp中提到一个开源工具可以用来进行xor评分猜测</p>
<p><a target="_blank" rel="noopener" href="https://github.com/hellman/xortool">https://github.com/hellman/xortool</a></p>
<h2 id="challenge-9"><a href="#challenge-9" class="headerlink" title="challenge 9"></a>challenge 9</h2><p>To be continue…still writing…</p>

      
      
        <div class="page-reward">
          <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang">赏</a></p>
          <div class="hide_box"></div>
          <div class="shang_box">
            <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
            <div class="shang_tit">
              <p>赞助gif换电脑、吃双皮奶(逃</p>
            </div>
            <div class="shang_payimg">
              <img src="/img/alipayimg.jpg" alt="扫码支持" title="扫一扫" />
            </div>
              <div class="pay_explain">扫码打赏，你说多少就多少</div>
            <div class="shang_payselect">
              
                <div class="pay_item checked" data-id="alipay">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/alipay.png" alt="支付宝" /></span>
                </div>
              
              
                <div class="pay_item" data-id="wechat">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/weixin.png" alt="微信" /></span>
                </div>
              
            </div>
            <div class="shang_info">
              <p>打开<span id="shang_pay_txt">支付宝</span>扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
        </div>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
        <script type="text/javascript">
          $(".pay_item").click(function(){
            $(this).addClass('checked').siblings('.pay_item').removeClass('checked');
            var dataid=$(this).attr('data-id');
            $(".shang_payimg img").attr("src","/img/"+dataid+"img.jpg");
            $("#shang_pay_txt").text(dataid=="alipay"?"支付宝":"微信");
          });
          function dashangToggle(){
            
            $(".hide_box").fadeToggle();
            $(".shang_box").fadeToggle();
          }
        </script>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/11/21/2018flare-on-recording/">2018flare-on recording</a></p>
        <p><span>文章作者:</span><a href="/" title="访问  的个人博客"></a></p>
        <p><span>发布时间:</span>2018年11月21日 - 10时52分</p>
        <p><span>最后更新:</span>2019年04月11日 - 17时46分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/11/21/2018flare-on-recording/" title="2018flare-on recording">http://giglf.github.io/2018/11/21/2018flare-on-recording/</a>
            <span class="copy-path" data-clipboard-text="原文: http://giglf.github.io/2018/11/21/2018flare-on-recording/　　作者: " title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2019/10/08/Flare-On-2019-Writeup/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          Flare-On 2019 Writeup
        
      </div>
    </a>
  
  
    <a href="/2018/10/08/%E8%AF%88%E5%B0%B8%E4%B8%80%E4%B8%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">诈尸一下</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-1"><span class="toc-number">1.</span> <span class="toc-text">Challenge 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-2"><span class="toc-number">2.</span> <span class="toc-text">Challenge 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-3"><span class="toc-number">3.</span> <span class="toc-text">Challenge 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-4"><span class="toc-number">4.</span> <span class="toc-text">Challenge 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-5"><span class="toc-number">5.</span> <span class="toc-text">Challenge 5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-6"><span class="toc-number">6.</span> <span class="toc-text">Challenge 6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-7"><span class="toc-number">7.</span> <span class="toc-text">Challenge 7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-8"><span class="toc-number">8.</span> <span class="toc-text">Challenge 8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#challenge-9"><span class="toc-number">9.</span> <span class="toc-text">challenge 9</span></a></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">


<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>





<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    
        <!-- 来必力City版安装代码 -->
        <div id="lv-container" data-id="city" data-uid="MTAyMC8zMTEzNi83Njg1">
            <script type="text/javascript">
           (function(d, s) {
               var j, e = d.getElementsByTagName(s)[0];
               if (typeof LivereTower === 'function') { return; }
               j = d.createElement(s);
               j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
               j.async = true;
               e.parentNode.insertBefore(j, e);
           })(document, 'script');
            </script>
        <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
        </div>
        <!-- City版安装代码已完成 -->
    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2019/10/08/Flare-On-2019-Writeup/" title="上一篇: Flare-On 2019 Writeup">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2018/10/08/%E8%AF%88%E5%B0%B8%E4%B8%80%E4%B8%8B/" title="下一篇: 诈尸一下">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/11/05/Flare-On-2020-Writeup/">Flare-On 2020 Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/08/Flare-On-2019-Writeup/">Flare-On 2019 Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/21/2018flare-on-recording/">2018flare-on recording</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/08/%E8%AF%88%E5%B0%B8%E4%B8%80%E4%B8%8B/">诈尸一下</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/06/Ubuntu%E5%85%8B%E9%9A%86mac%E5%9C%B0%E5%9D%80%E5%90%8E%E8%BF%9E%E4%B8%8D%E4%B8%8A%E7%BD%91/">Ubuntu克隆mac地址后连不上网</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/26/FindTheActivity%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95/">FindTheActivity出题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/31/%E7%BC%96%E8%AF%91%E5%B0%8F%E7%B1%B33td%E5%86%85%E6%A0%B8%E8%AE%B0%E5%BD%95/">编译小米3td内核记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/28/Blog-update-again/">Blog update again...</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/22/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90Android-so%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/">源码分析Android so加载过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/12/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%AAWindows%E4%B8%8BMakefile%E7%9A%84%E7%A5%9E%E5%9D%91/">记录一个Windows下Makefile的神坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/25/pwnable-kr-%E6%80%9D%E8%B7%AF/">pwnable.kr_思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/09/Blog-update/">Blog update!</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/04/About-recently/">About recently</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/11/Android%E7%AD%BE%E5%90%8D%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D%EF%BC%882%EF%BC%89-schemev2/">Android签名原理介绍（2）--schemev2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/07/Android%E7%AD%BE%E5%90%8D%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D%EF%BC%881%EF%BC%89--schemev1/">Android签名原理介绍（1）--schemev1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/21/NGfish_mini-lctf_writeup/">NGfish_mini-lctf_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/20/pwnhub%E6%97%A0%E7%94%A8%E7%9A%84%E7%94%B5%E8%84%91-%E4%B8%A7%E5%BF%83%E7%97%85%E7%8B%82-writeup/">pwnhub无用的电脑_丧心病狂_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/17/%E5%90%84%E7%A7%8D%E7%BC%96%E7%A0%81%E5%8C%BA%E5%88%AB%E5%8F%8A%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84/">各种编码区别及内存映射</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/28/2016minilctf-Forensics500-Angel-Beats/">2016minilctf-Forensics500-Angel Beats!</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/21/Ubuntu%E7%9A%84apache2%E9%85%8D%E7%BD%AEPHP%E4%B8%8D%E8%83%BD%E8%BF%90%E8%A1%8C%E9%97%AE%E9%A2%98/">Ubuntu的apache2配置PHP不能运行问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/14/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9D%91%E4%B9%8B%E8%AE%B0%E5%BD%95/">数据库坑之记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/06/%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0-nasm%E4%BD%BF%E7%94%A8-%E8%B0%83%E8%AF%95/">汇编学习&&nasm使用&&调试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/11/L-ctf%E7%A5%9E%E5%A5%87%E7%9A%84%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6/">2016 L-ctf神奇的压缩文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/23/%E6%BB%B4%E6%BB%B4-%E5%AD%A6%E7%94%9F%E5%8D%A1/">滴滴!!!学生卡</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/11/Android-APP%E7%A0%B4%E8%A7%A3-Forest3-6-2/">Android APP破解--Forest3.6.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B-%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%811/">全国大学生信息安全竞赛初赛_对称密码1</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/26/%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B_%E7%8F%8D%E8%B4%B5%E8%B5%84%E6%96%99/">全国大学生信息安全竞赛初赛_珍贵资料</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/14/reversing-kr-ImagePic-Write-up/">reversing.kr_ImagePic Write up</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/09/%E4%B8%A4%E5%B9%B4%E4%BA%86/">两年了</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/07/reversing-kr%E5%9B%9B%E9%81%93Easy/">reversing.kr四道Easy</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/05/btcf_quals_2014%E2%80%94%E2%80%94%E6%9C%80%E9%9A%BE%E7%9A%84%E9%A2%98%E7%9B%AE/">btcf_quals_2014——最难的题目</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/30/reversing.kr_replace-Write-up/">reversing.kr_replace Write up</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/29/%E4%B8%80%E7%AF%87helloworld%E5%8F%8A%E4%BA%9B%E8%AE%B8%E8%AF%B4%E6%98%8E/">一篇helloworld及些许说明</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2021 giglf
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >dalao到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>


<script src="/js/main.js"></script>


    <script>
        $(document).ready(function() {
            var backgroundnum = 8;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-107314179-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?549394a97554b370d120d5a854f98672";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>